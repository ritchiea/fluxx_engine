- if @skip_wrapper
  = render :partial => @template,  :locals => {:model => @model}
- else
  %div{:id=>"card-header"}= raw "#{raw flash_info} #{raw flash_error}"

  %div{:id=>"card-body"}
    %div.show
      = render :partial => @template, :locals => { :model => @model }

  - if @related && ! @exclude_related_data
    %ol{:id=>"card-drawer"}
      - @related.each do |rd|
        %li.section
          - if rd[:lazy_load_url]
            %span.label{:class => "lazy-load", "data-src".to_sym => rd[:lazy_load_url]}
              = rd[:display_name]
            %ol.entries  
          - else
            %span.label= rd[:display_name]
            %ol.entries
              - rd[:formatted_data].each do |element|
                - section_title = if element[:display_template]
                  - render :partial => element[:display_template], :locals => {:model => element[:model]}
                - else
                  - element[:model].to_s
                %li.entry
                  = link_to((element[:model_url] || element[:model]), :class => 'new-detail', 'data-insert' => 'after', 'title' => truncate(element[:title], :length => 45)) do
                    %span= section_title

  %div{:id=>"card-footer"}
    - if @footer_template
      = render :partial => @footer_template, :locals => { :model => @model}
    - else
      %ul.buttons
        - if @model
          - if !current_user.respond_to?(:has_update_for_model) || current_user.has_update_for_model?(@model)
            %li= link_to 'Edit', send("edit_#{@model_name}_path", @model), :class => 'to-self', :link_class => 'btn'
          - if !current_user.respond_to?(:has_delete_for_model) || current_user.has_delete_for_model?(@model)
            %li= link_to 'Delete', send("#{@model_name}_path", @model), :class => 'as-delete', 'data-on-success' => 'refreshCaller', :link_class => 'btn'
          %li= link_to 'Printable', '#', :target => "_blank", :class => 'btn area-url'
  = render :partial => 'insta/card_settings'